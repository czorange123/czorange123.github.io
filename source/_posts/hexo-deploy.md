---
title: hexoä¸€é”®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨
date: 2018-05-01 11:44:37
tags:
	- Hexo
categories:
	- Hexo
	- Setup and deployment
---
ä¸Šä¸€ç¯‡è®°å½•äº†[å¦‚ä½•æ­å»ºä¸€ä¸ªç®€æ˜“çš„ä¸ªäººç½‘ç«™](hexo-build.html)ï¼Œé‡‡ç”¨`hexo`ï¼Œ`github pages`è¿›è¡Œæ­å»ºä¸éƒ¨ç½²ã€‚
æœ¬ç¯‡ä¸»è¦è®°å½•ä¸‹å¦‚ä½•å°†hexoåšå®¢éƒ¨ç½²åˆ°é`github pages`çš„ç¬¬ä¸‰æ–¹äº‘æœåŠ¡å™¨ä¸Šï¼Œå¹¶å®ç°ä¸€é”®éƒ¨ç½²ã€‚

> ä»¥ä¸‹æœ¬åœ°æ“ä½œå‡åœ¨Ubuntu 18.04.1 LTSä¸­è¿›è¡Œæµ‹è¯•ã€‚
> ä»¥ä¸‹äº‘æœåŠ¡å™¨ä¸Šæ“ä½œåœ¨é˜¿é‡Œäº‘Ubuntu 16.04.4 LTS \n \lä¸­è¿›è¡Œæµ‹è¯•ã€‚

### å‡†å¤‡å·¥ä½œ
- [x] ä¸€å°äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
- [x] å·²æœ‰hexoåšå®¢æ¡†æ¶æ­å»ºçš„åšå®¢ï¼ˆå…·ä½“å¯å‚è€ƒæˆ‘[ä¸Šä¸€ç¯‡è®°å½•æ–‡ç« ](hexo-build.html)ï¼‰

## # ä¼ ç»Ÿéƒ¨ç½²æ–¹æ³•

#### æ‰“åŒ…æœ¬åœ°hexoåšå®¢é¡¹ç›®ï¼Œä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ä¸Šï¼Œå†é…ç½®nginxã€‚

##### æ‰“åŒ…ç”Ÿæˆé™æ€æ–‡ä»¶
```shell
$ hexo generate
```
##### æŠŠæ ¹ç›®å½•ä¸‹ç”Ÿæˆçš„`public`æ–‡ä»¶å¤¹å‹ç¼©ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹
```shell
# å‹ç¼©æˆhtml.zip
$ zip -q -r html.zip public
# å°†html.zipä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨
$ scp html.zip ç”¨æˆ·å@æœåŠ¡å™¨å…¬ç½‘ip:~
```
##### æœåŠ¡å™¨ä¸Šè§£å‹æ–‡ä»¶
```shell
# å…ˆç™»å½•è‡ªå·±çš„æœåŠ¡å™¨
$ ssh ç”¨æˆ·å@æœåŠ¡å™¨å…¬ç½‘ip
# æ‰¾åˆ°åˆšä¸Šä¼ ä¸Šæ¥çš„html.zipå¹¶è§£å‹ç¼©ï¼Œæˆ‘è¿™é‡ŒæŠŠè§£å‹ç¼©çš„æ–‡ä»¶æ”¾åœ¨/var/www/blog/ä¸‹é¢
$ cd /var/www
$ sudo mkdir blog
$ cd blog
$ sudo cp ~/html.zip .
$ sudo unzip html.zip
# å¾—åˆ°publicæ–‡ä»¶
```
##### é…ç½®nginx
å¦‚æœä½ æœåŠ¡å™¨ä¸Šå·²ç»å®‰è£…äº†nginxï¼Œç›´æ¥çœ‹ä¸‹é¢ã€‚å¦åˆ™å‚è€ƒ[nginxçš„å®‰è£…ä¸é…ç½®](https://yq.aliyun.com/articles/710641?spm=5176.10695662.1996646101.searchclickresult.155256a0P4F06Z&aly_as=MUa5PXuo)
å¯åŠ¨ngxinï¼Œæ­£å¸¸å®‰è£…å®Œæˆåé»˜è®¤å·²ç»å¯åŠ¨
```shell
$ sudo nginx
```
æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ipæŸ¥çœ‹nginxæ˜¯å¦å®‰è£…å¹¶å¯åŠ¨ã€‚
å‡ºç°`Welcome to nginx!`å­—æ ·è¯´æ˜å¯åŠ¨æˆåŠŸï¼Œå¦åˆ™è‡ªè¡Œæœç´¢è§£å†³é—®é¢˜ã€‚

ç°åœ¨é…ç½®hexoåšå®¢nginx
```shell
# nginxé…ç½®æ–‡ä»¶åœ¨/etc/nginxä¸‹
$ cd /etc/nginx/sites-enabled
# æ–‡ä»¶å¤¹ä¸‹æœ‰defaultæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å®ƒ
$ sudo vim default
```
æ‰“å¼€ä»¥åå¦‚ä¸‹å›¾æ˜¾ç¤º
![](/images/hexo-deploy/nginx-default.png)
ä¿®æ”¹çº¢æ¡†æ ‡æ³¨çš„åœ°æ–¹ä¸ºä½ ä¹‹å‰è§£å‹html.zipçš„ç›®å½•ï¼Œå³`/var/www/blog/public`ã€‚
ä¿å­˜é€€å‡ºï¼Œé‡è½½nginxã€‚
```shell
$ sudo nginx -s reload
```
å†æ¬¡è®¿é—®è®¿é—®æœåŠ¡å™¨ipï¼Œç°åœ¨åº”è¯¥å‡ºç°çš„æ˜¯ä½ åšå®¢ä¸»é¡µäº†ã€‚

----

#### ä»¥ä¸Šæ˜¯å¹³æ—¶å¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Œå®¹æ˜“ç†è§£ã€‚ä½†æ˜¯è¿‡ç¨‹å¤æ‚ï¼Œæ¯æ¬¡æ›´æ–°åšå®¢éœ€è¦é‡æ–°éƒ¨ç½²ï¼Œé‡å¤ä»¥ä¸Šç¹æ‚æ“ä½œã€‚

#### æ¥ä¸‹æ¥ä»‹ç»ä¸€ç§ä¸€åŠ³æ°¸é€¸çš„éƒ¨ç½²æ–¹å¼

----

## # ä¸€åŠ³æ°¸é€¸çš„ä¸€é”®éƒ¨ç½²æ–¹å¼

### åŸç†ä¸æ€è·¯
>- ç±»ä¼¼äºhexoåšå®¢`ä¸€é”®éƒ¨ç½²`åŠŸèƒ½ï¼Œåˆ©ç”¨`hexo d`å‘½ä»¤å®Œæˆéƒ¨ç½²ã€‚
>- å€ŸåŠ©gitå®Œæˆéƒ¨ç½²ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹ä¸€ä¸ªgitä»“åº“ï¼Œé€šè¿‡å‘½ä»¤æŠŠä»£ç æäº¤åˆ°gitä»“åº“ï¼Œå¹¶ä¸”è§¦å‘`git hooks`é…ç½®bashå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œå®Œæˆç›®å½•æ‹·è´ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯å¸¸è§çš„éƒ¨ç½²æ–¹å¼è‡ªåŠ¨åŒ–æ‰§è¡Œçš„è¿‡ç¨‹ã€‚

### ç¬¬ä¸€æ­¥ï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä»“åº“
```bash
$ mkdir blog.git
$ cd blog.git
$ git init --bare
```

å¦‚æœæç¤ºgitä¸å­˜åœ¨ï¼Œè¯·å…ˆå®‰è£…gitï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚

### ç¬¬äºŒæ­¥ï¼Œè®¾ç½®è‡ªåŠ¨éƒ¨ç½²é’©å­ï¼Œä¹Ÿå°±æ˜¯é…ç½®git hooks
è¿›å…¥hooksç›®å½•ä¸‹ï¼Œåˆ›å»º`post-receive`é’©å­æ–‡ä»¶
```bash
$ cd hooks
$ touch post-receive
```
ç¼–è¾‘`post-receive`
```bash
$ sudo vim post-receive
```
è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œå¹¶ä¿å­˜é€€å‡º
```
GIT_REPO=/var/www/blog.git
TMP_GIT_CLONE=/var/www/tmp/blog
PUBLIC_WWW=/var/www/blog
rm -rf ${TMP_GIT_CLONE}
git clone $GIT_REPO $TMP_GIT_CLONE
rm -rf ${PUBLIC_WWW}/*
cp -rf ${TMP_GIT_CLONE}/ ${PUBLIC_WWW}
```

é…ç½®è§£é‡Šï¼š
>- `GIT_REPO`ï¼š æœåŠ¡å™¨gitä»“åº“æ‰€åœ¨ç›®å½•ï¼Œæ­¤ç›®å½•å¹¶ä¸æ”¾åšå®¢é¡¹ç›®ã€‚
- `TMP_GIT_CLONE`ï¼š ä¸´æ—¶ç›®å½•ï¼Œgitä¼šå°†æäº¤çš„æ–‡ä»¶å…ˆå­˜åˆ°ä¸´æ—¶ç›®å½•ã€‚
- `PUBLIC_WWW`ï¼š æœåŠ¡å™¨ä¸Šæ”¾åšå®¢é¡¹ç›®çš„ç›®å½•ï¼Œä½ æƒ³å°†åšå®¢æ”¾åœ¨å“ªï¼Œä¿®æ”¹æ­¤é¡¹å³å¯ã€‚ æ³¨æ„æ­¤ç›®å½•åº”å¯¹äº`nginx root`è®¾ç½®çš„ç›®å½•ã€‚
- ä¸‹é¢å››è¡Œå³ä¸ºbashå‘½ä»¤ï¼Œè®¾ç½®å¥½å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚

æ³¨æ„ï¼š
> ä¸Šè¿°æ–‡ä»¶å‡ºç°çš„`/var/www`ä¸ºæ ¹ç›®å½•ï¼Œè¿™é‡Œæ˜¯æˆ‘ä¸ªäººé…ç½®ã€‚ä¾›å‚è€ƒï¼Œå…·ä½“è‡ªè¡Œä¿®æ”¹è®¾ç½®ã€‚

#### ä¿®æ”¹ç›®å½•æƒé™
```bash
$ chmod +x post-receive
$ chmod 777 -R /var/www/blog
```

### ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹æœ¬åœ°åšå®¢é…ç½®
æ‰“å¼€é¡¹ç›®æ–‡ä»¶ï¼Œæ‰¾åˆ°`_config.yml`æ‰“å¼€ï¼Œæ‰¾åˆ°`deploy`é…ç½®è¿›è¡Œä¿®æ”¹ã€‚
```
deploy:
  type: git
  message: update pages
  repo: username@xx.xx.xxx.xx:/var/www/blog.git
  branch: master
```
è¿™é‡Œçš„`repo`é…ç½®æ˜¯æœåŠ¡å™¨åœ°å€é…ç½®ã€‚å†’å·åé¢å¯¹åº”çš„æ˜¯ä¸Šä¸€æ­¥è®¾ç½®çš„ä»“åº“ç›®å½•åœ°å€ã€‚`branch`æ˜¯gitåˆ†æ”¯ã€‚

ä¿®æ”¹å¥½åæ‰§è¡Œ`hexo g`è¿›è¡Œç¼–è¯‘ï¼Œå†æ‰§è¡Œ`hexo d`è¿›è¡Œéƒ¨ç½²ã€‚

æç¤ºè¾“å…¥å¯†ç ï¼Œè¿™é‡Œè¾“å…¥æœåŠ¡å™¨ç™»å½•å¯†ç å³å¯ã€‚å‡ºç°ä»¥ä¸‹ä¿¡æ¯éƒ¨ç½²å®Œæˆï¼š
```
Branch 'master' set up to track remote branch 'master' from 'xx@xx.xx.xxx:/var/www/blog.git'.
INFO  Deploy done: git
```

The EndğŸ˜€
